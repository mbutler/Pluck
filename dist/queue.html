<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pluck Timeline Test</title>
</head>
<body>
  <h1>Pluck Timeline Test</h1>
  <p>Click the button below to start the timeline and play sounds.</p>
  <button id="startButton">Start Timeline</button>
  <button id="stopButton">Stop Timeline</button>
  <script src="pluck.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const startButton = document.getElementById('startButton')
      const stopButton = document.getElementById('stopButton')
      let timeline
      startButton.addEventListener('click', async () => {
        timeline = new window.Pluck.Timeline()
        await timeline.start()
        let future = timeline.future()

        // start the timer before new sounds are created and scheduled for more accurate timing
        timeline.startInterval(14, () => {
          console.log("Another 14 seconds.", timeline.currentTime)
        })

        // Create and initialize sounds in various and fun ways

        // create a Pluck Sound directly by passing in options
        const sound1 = new window.Pluck.Sound({ file: 'sound1.mp3', context: timeline.context, offset: 12})
        const sound2 = new window.Pluck.Sound({ file: 'sound2.mp3', context: timeline.context})
        const sound3 = new window.Pluck.Sound({ file: 'snd.mp3', context: timeline.context })

        await sound1.initialized
        await sound2.initialized
        await sound3.initialized
     
        // make sure sounds are initialized before scheduling or grouping them
        const group = new window.Pluck.Group(timeline.context)
        group.addSounds([sound1, sound2, sound3])

        // play 
        group.play()

        /////////
        // cant do this because it's being used in the Group
        // sound1.play() // just don't do this I guess
        /////////

        // set a setTimer and then change the volume of the group
        // this doesn't work yet
        setTimeout(() => {
          group.mute()
          console.log("Group muted", group)
        }, 20 * 1000)

        // use the Timeline to create and schedule a Sound, passing in options
        const sound4 = timeline.addSound( 'snd.mp3', 15, { volume: 0.69 })
        await sound4.initialized

        const sound5 = timeline.addSound( 'snd.mp3', timeline.future(30))

        

        console.log("Sounds initialized")
        /*
        // Schedule sound1 to play at 1 second
        timeline.scheduleSound(sound1, 1)
        console.log("Scheduled sound1 to play at 1 second")

        // Schedule sound2 to play at 3 seconds
        timeline.scheduleSound(sound2, 3)
        console.log("Scheduled sound2 to play at 3 seconds")

        // Schedule sound3 to play at 5 seconds
        timeline.scheduleSound(sound3, timeline.currentTime + 15)
        console.log("Scheduled sound3 to play at 15 seconds in the future")

        // Reschedule sound2 to play at 25 seconds
        timeline.rescheduleSound(sound3, 25)
        console.log("Rescheduled sound3 to play at 25 seconds")

        // Play sound1 immediately
        timeline.playNow(sound1)
        console.log("Playing sound1 immediately")

        // Log events to the console
        timeline.on('onSoundScheduled', (sound, time) => {
          `Sound ${sound.file} scheduled to play at ${time} seconds}`
        })
        */
        timeline.on('onSoundPlayed', (sound, time) => {
          console.log(`ALERT::: Sound ${sound.fileName} played at ${time} seconds}`)
        })

        timeline.on('onLoop', () => {
        })

        timeline.on('onStop', () => {
          console.log('Timeline stopped.')
        })

        console.log("Timeline started")
      })
        
      stopButton.addEventListener('click', () => {
        timeline.stop()
      })
    })
  </script>
</body>
</html>
